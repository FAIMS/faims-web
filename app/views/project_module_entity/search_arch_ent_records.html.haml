- title @project_module.name + " - Search Entity Records"
= breadcrumbs
.content
  %h2 Search Entity
  %form{:action => search_arch_ent_records_path, :method => "get"}
    %p An empty search will list all entities
    .input-append
      %select{:name => 'type'}
        - if params[:type] == 'all'
          %option{ :value => "all", :selected => "selected"}="Show All Records"
        - else
          %option{ :value => "all" }="Show All Records"
        - for type in @types
          - if params[:type] == type[1].to_s
            %option{:value=>type[1], :selected => "selected"}=type[0]
          - else
            %option{:value=>type[1]}=type[0]
      %select{:name => 'user'}
        - if params[:user] == 'all'
          %option{ :value => "all", :selected => "selected"}="Any User"
        - else
          %option{ :value => "all" }="Show All Records"
        - for user in @users
          - if params[:user] == user[0].to_s
            %option{:value=>user[0], :selected => "selected"}="#{user[1]} #{user[2]}"
          - else
            %option{:value=>user[0]}="#{user[1]} #{user[2]}"
      %input{:type => 'text', :name => 'query'}
      %input{:type => 'hidden', :name => 'show_deleted', :value => params[:show_deleted]}
      %input{:type => 'hidden', :name => 'offset', :value => params[:offset]}
      %input{:type => 'hidden', :name => 'per_page', :value => @limit}
      %input{:type => 'submit', :value => "Search", :class => 'btn'}

  - if @uuid and not @uuid.empty?
    %form{:method => 'post', :id => 'compare'}
      %input{:type => 'hidden', :value => form_authenticity_token, :name => 'authenticity_token'}
      - pagination_options = [['50 per page', '50'], ['100 per page', '100'], ['250 per page', '250'], ['Show all', '-1']]
      = select_tag :per_page, options_for_select(pagination_options, @limit.to_s), :onchange => 'updatePagination(this.value)'
      %p
        = render :partial => 'edit_arch_ent_record'
  - else
    %p No Records Found

  .form-actions
    = link_to "<i class='icon-arrow-left'></i> Back".html_safe, project_module_path(@project_module), :class => 'btn'
    = link_to "Compare", compare_arch_ents_path(@project_module, search_params), :id => 'compare-button', :class => 'btn btn-inverse'
    - if params[:show_deleted].blank?
      = link_to "Delete Selected", batch_delete_arch_ents_path(@project_module, search_params), :id => 'delete-selected-button', :class => 'btn btn-inverse'
      = link_to "Show Deleted", '#', :id => 'show-hide-deleted', :class => 'btn btn-inverse'
    - else
      = link_to "Restore Selected", batch_restore_arch_ents_path(@project_module, search_params), :id => 'restore-selected-button', :class => 'btn btn-inverse'
      = link_to "Hide Deleted", '#', :id => 'show-hide-deleted', :class => 'btn'
    %form{:action => search_arch_ent_records_path, :method => "get", :id => 'show-hide-deleted-form'}
      %input{:type => 'hidden', :value => params[:type], :name => 'type'}
      %input{:type => 'hidden', :value => params[:user], :name => 'user'}
      %input{:type => 'hidden', :value => params[:query], :name => 'query'}
      %input{:type => 'hidden', :value => params[:offset], :name => 'offset', :value => params[:offset]}
      %input{:type => 'hidden', :value => params[:per_page], :name => 'per_page', :value => @limit}
      - if params[:show_deleted].blank?
        %input{:type => 'hidden', :value => 'true', :name => 'show_deleted'}
    %form{:method => 'post', :id => 'delete-ent-form'}
      %input{:type => 'hidden', :value => form_authenticity_token, :name => 'authenticity_token'}
      %input{:type => 'hidden', :name => 'selected', :id => 'selected-ents-delete'}
    %form{:method => 'post', :id => 'restore-ent-form'}
      %input{:type => 'hidden', :value => form_authenticity_token, :name => 'authenticity_token'}
      %input{:type => 'hidden', :name => 'selected', :id => 'selected-ents-restore'}

:javascript
  function updatePagination(per_page) {
    window.location = "#{@base_url}&offset=0&per_page=" + per_page
  }
